const Menu = [
    {
        name: 'MurderShake Meal',
        uid: 'murdershakemeal',
        price: 300,
        display: true,
        image: 'assets/images/items/murdershakemeal.png',
        items: '1 Mystery Burger, 2 Sides, 1 Milkshake, 1 Rimjob',
        itemType: 'combo'
    },
    {
        name: 'MurderMeal Combo',
        uid: 'murdermeal',
        price: 250,
        display: true,
        image: 'assets/images/items/murdermeal.png',
        items: '1 Mystery Burger, 1 Side, 1 Drink',
        itemType: 'combo'
    },
    {
        name: 'JackPot Meal',
        uid: 'jackpotmeal',
        price: 700,
        display: true,
        image: 'assets/images/items/jackpotmeal.png',
        items: '1 Moneyshot, 1 Lucky Rings, 1 Copium',
        itemType: 'combo'
    },    
    {
        name: 'Running Man Combo',
        uid: 'runningman',
        price: 250,
        display: true,
        image: 'assets/images/items/runningman.png',
        items: '2 Fries, 2 Rimjobs, 1 Soda',
        itemType: 'combo'
    },
    {
        name: 'Milkshake and Fries Combo',
        uid: 'milkshakefries',
        price: 200,
        display: true,
        image: 'assets/images/items/milkshakefries.png',
        items: '2 Milkshakes, 2 Fries',
        itemType: 'combo'
    },
    {
        name: 'Salty Seaman Combo',
        uid: 'saltyseaman',
        price: 200,
        display: true,
        image: 'assets/images/items/saltyseaman.png',
        items: '2 Fries, 2 Drinks',
        itemType: 'combo'
    },
    {
        name: 'Lucky Fisherman Combo',
        uid: 'luckyfisherman',
        price: 200,
        display: true,
        image: 'assets/images/items/luckyfisherman.png',
        items: '2 Lucky Rings, 2 Drinks',
        itemType: 'combo'
    },
    {
        name: 'Stretchy Destress',
        uid: 'stretchydestress',
        price: 200,
        display: true,
        image: 'assets/images/items/stretchydestress.png',
        items: '4 Mozzarella Sticks',
        itemType: 'combo'
    },
    {
        name: 'Sweet Tooth Combo',
        uid: 'sweettooth',
        price: 162,
        display: true,
        image: 'assets/images/items/sweettooth.png',
        items: '2 Milkshakes, 2 Cream Pies',
        itemType: 'combo'
    },
    {
        name: 'Morning Glory Combo',
        uid: 'morningglory',
        price: 150,
        display: true,
        image: 'assets/images/items/morningglory.png',
        items: '1 Oatmeal, 1 Bacon, 1 OJ',
        itemType: 'combo'
    },
    {
        name: 'Sugar Rush Combo',
        uid: 'sugarrush',
        price: 123,
        display: true,
        image: 'assets/images/items/sugarrush.png',
        items: '1 Soda, 1 Rimjob, 1 Cream Pie',
        itemType: 'combo'
    },
    {
        name: 'Chicken Dinner',
        uid: 'chickendinner',
        price: 420,
        display: true,
        image: 'assets/images/items/chickendinner.png',
        items: '1 Chicken, 1 Wrap, 1 Mozzarella Stick, 1 Copium',
        itemType: 'combo'
    },
    {
        name: 'Heartstopper Combo',
        uid: 'heartstoppercombo',
        price: 175,
        display: true,
        image: 'assets/images/items/heartstoppercombo.png',
        items: '1 Heartstopper, 1 Fries, 1 Soda',
        itemType: 'combo'
    },
    {
        name: 'Moneyshot Meal',
        uid: 'moneyshotmeal',
        price: 575,
        display: true,
        image: 'assets/images/items/moneyshotmeal.png',
        items: '1 Moneyshot, 1 Fries, 1 Soda',
        itemType: 'combo'
    },
    {
        name: 'Bleeder Meal',
        uid: 'bleedermeal',
        price: 200,
        display: true,
        image: 'assets/images/items/bleedermeal.png',
        items: '1 Bleeder, 1 Fries, 1 Soda',
        itemType: 'combo'
    },
    {
        name: 'Heartstopper',
        uid: 'heartstopper',
        price: 75,
        display: true,
        image: 'assets/images/items/heartstopper.png',
        items: '',
        itemType: 'main'
    },
    {
        name: 'Money Shot',
        uid: 'moneyshot',
        price: 500,
        display: true,
        image: 'assets/images/items/moneyshot.png',
        items: '',
        itemType: 'main'
    },
    {
        name: 'Bleeder',
        uid: 'bleeder',
        price: 100,
        display: true,
        image: 'assets/images/items/bleeder.png',
        items: '',
        itemType: 'main'
    },
    {
        name: 'Oatmeal',
        uid: 'oatmeal',
        price: 50,
        display: true,
        image: 'assets/images/items/oatmeal.png',
        items: '',
        itemType: 'main'
    },
    {
        name: 'Fries',
        uid: 'fries',
        price: 55,
        display: true,
        image: 'assets/images/items/fries.png',
        items: '',
        itemType: 'side'
    },
    {
        name: 'Lucky Rings',
        uid: 'luckyrings',
        price: 100,
        display: true,
        image: 'assets/images/items/luckyrings.png',
        items: '',
        itemType: 'side'
    },
    {
        name: 'Mozz Sticks',
        uid: 'mozzsticks',
        price: 55,
        display: true,
        image: 'assets/images/items/mozzsticks.png',
        items: '',
        itemType: 'side'
    },
    {
        name: 'Bacon',
        uid: 'bacon',
        price: 50,
        display: true,
        image: 'assets/images/items/bacon.png',
        items: '',
        itemType: 'side'
    },
    {
        name: 'Bloody Fingers',
        uid: 'bloodyfingers',
        price: 40,
        display: true,
        image: 'assets/images/items/bloodyfingers.png',
        items: '',
        itemType: 'side'
    },
    {
        name: 'Salad',
        uid: 'salad',
        price: 55,
        display: true,
        image: 'assets/images/items/salad.png',
        items: '',
        itemType: 'side'
    },
    {
        name: 'Rimjob',
        uid: 'rimjob',
        price: 45,
        display: true,
        image: 'assets/images/items/rimjob.png',
        items: '',
        itemType: 'dessert'
    },
    {
        name: 'Cream Pie',
        uid: 'creampie',
        price: 33,
        display: true,
        image: 'assets/images/items/creampie.png',
        items: '',
        itemType: 'dessert'
    },
    {
        name: 'Soda',
        uid: 'soda',
        price: 45,
        display: true,
        image: 'assets/images/items/soda.png',
        items: '',
        itemType: 'drink'
    },
    {
        name: 'Milkshake',
        uid: 'milkshake',
        price: 48,
        display: true,
        image: 'assets/images/items/milkshake.png',
        items: '',
        itemType: 'drink'
    },
    {
        name: 'Copium',
        uid: 'copium',
        price: 100,
        display: true,
        image: 'assets/images/items/copium.png',
        items: '',
        itemType: 'drink'
    },
    {
        name: 'Orange Juice',
        uid: 'orangejuice',
        price: 45,
        display: true,
        image: 'assets/images/items/orangejuice.png',
        items: '',
        itemType: 'drink'
    },
    {
        name: 'Lemonade',
        uid: 'lemonade',
        price: 45,
        display: true,
        image: 'assets/images/items/lemonade.png',
        items: '',
        itemType: 'drink'
    },
    {
        name: 'Toy',
        uid: 'toy',
        price: 101,
        display: true,
        image: 'assets/images/items/toy.png',
        items: '',
        itemType: 'toy'
    }
];

function loadItems() {
    let itemList = document.getElementById('itemsContainer');
    let lastItemType = "";
    Menu.forEach(menuItem => {
        if (menuItem.display == true) {
            if (menuItem.itemType  !== lastItemType) {
                itemList.innerHTML += `<div class="col-md-12 col-sm-12 col-12">${capitalizeFirstLetter(menuItem.itemType)}s</div>`;
                lastItemType = menuItem.itemType;
            }

            itemList.innerHTML += 
            `<div class="col-md-3 col-sm-3 col-3 text-center">
                <figure class="card card-product" onclick="addItem('${menuItem.uid}','${menuItem.name}',${menuItem.price},'${menuItem.image}','${menuItem.items}')">
                    <div class="img-wrap">
                        <img draggable="false" src=${menuItem.image}>
                    </div>
                    <figcaption class="info-wrap">
                        <span class="title h6">${menuItem.name}</span>
                        <div class="action-wrap">
                            <span class="btn btn-primary disabled btn-sm"> <i
                                    class="fa fa-cart-plus"></i>$${menuItem.price} </span>
                        </div> <!-- action-wrap -->
                    </figcaption>
                </figure> <!-- card // -->
            </div> <!-- col // -->`
        }
    });
}

function addItem(uid, name, price, image, items) {
    var receiptItem = 'receipt-item-' + uid;
    var priceItem = 'price-item-' + uid;
    var quantityItem = 'quantity-item-' + uid;
    if (document.getElementById(receiptItem)) {
        let orderPriceString = document.getElementById(priceItem).innerText.replace(/\D/g, '');
        let orderQuantityString = document.getElementById(quantityItem).innerText.replace(/\D/g, '');
        let orderPrice = Number(orderPriceString);
        let orderQuantity = Number(orderQuantityString);
        orderPrice += 1 * price
        orderQuantity += 1
        document.getElementById(priceItem).innerText = '$' + orderPrice
        document.getElementById(quantityItem).innerText = orderQuantity
        totalPrice();
    }
    else {
        let receiptList = document.getElementById('tbody');
        let title = `<h6 class="title text-truncate menu-item">${name}</h6>`;
        if (items !== '') {
            title += `<h8 class="title text-truncate staff-help"><i>${items}</i></h8>`;
        }
        receiptList.innerHTML += 
        `<tr class="receipt-item" id="receipt-item-${uid}">
            <td>
                <figure class="media">
                    <div class="img-wrap"><img draggable="false" src="${image}"
                        class="img-thumbnail img-xs"></div>
                    <figcaption class="media-body">
                        ${title}
                    </figcaption>
                </figure>
            </td>
            <td class="text-center">
                <div class="m-btn-group m-btn-group--pill btn-group mr-2" role="group"
                    aria-label="...">
                    <button type="button" class="m-btn btn btn-default" onclick="removeItem('${uid}',${price},1)"><i
                            class="fa fa-minus"></i></button>
                    <button type="button" class="m-btn btn btn-default quantity" id="${quantityItem}" disabled>1</button>
                    <button type="button" class="m-btn btn btn-default" onclick="addItem('${uid}','${name}',${price},'${image}')"><i
                            class="fa fa-plus"></i></button>
                </div>
            </td>
            <td>
                <div class="price-wrap">
                    <var class="price" id="${priceItem}">$${price}</var>
                </div>
            </td>
            <td class="text-right">
                <span class="btn btn-outline-danger" onclick="deleteItem('${uid}')"> <i class="fa fa-trash"></i></span>
            </td>
        </tr>`
        totalPrice();
    }
}

function removeItem(uid, price, quantity) {
    if (document.getElementById('receipt-item-' + uid)) {
        let orderPriceString = document.getElementById('price-item-' + uid).innerText.replace(/\D/g, '');
        let orderQuantityString = document.getElementById('quantity-item-' + uid).innerText.replace(/\D/g, '');
        let orderPrice = Number(orderPriceString);
        let orderQuantity = Number(orderQuantityString);
        if (orderQuantity > 1) {
            orderPrice -= price
            orderQuantity -= quantity
            document.getElementById('price-item-' + uid).innerText = '$' + orderPrice
            document.getElementById('quantity-item-' + uid).innerText = orderQuantity
            totalPrice();
        }
    }  
}
function deleteItem(item) {
    document.getElementById('receipt-item-' + item).remove();
    totalPrice();
}

function resetTill(item) {
    document.getElementById('tbody').innerHTML = '';
    totalPrice();
}

function applyDiscount(item) {
    let discountPercent = .20;
    let total = document.getElementById('totalCost').innerText.replace(/\D/g, '');
    let discountedTotal = total - (total * discountPercent);
    document.getElementById('totalCost').innerText = '$' + discountedTotal;
}

function totalPrice() {
    var elements = document.getElementsByClassName('price');
    if (elements.length == 0) {
        document.getElementById('totalCost').innerText = '$' + 0
        generateComment();
    }
    else {
        prices = [];
        for (var i = 0; i < elements.length; ++i) {
            var priceElement = elements[i].innerHTML.replace(/\D/g, '');
            var price = Number(priceElement)
            prices.push(price);
            let total = prices.reduce(function (acc, val) { return acc + val; }, 0)
            document.getElementById('totalCost').innerText = '$' + total
            generateComment();
        }
    }
}

function generateComment() {
    document.getElementById('orderComment').innerText = "";
    var itemComments = []
    var itemQuantity = []
    var quantity = document.getElementsByClassName("quantity");
    for (var a = 0; a < quantity.length; a++) {
        itemQuantity.push(quantity[a].innerText);
    }
    var receiptItems = document.getElementsByClassName("menu-item");
    for (var i = 0; i < receiptItems.length; i++) {
        itemComments.push(quantity[i].innerText + "x " + receiptItems[i].innerText);
    }
    document.getElementById('orderComment').innerHTML = `<button class="btn btn-primary btn-lg" id='copyToClipBoard' data-clipboard-target="#orderComment">
    <span class="h5">Copy Order Comment</span>
  </button> <br> <div style="color:white;">`+  itemComments.join(' '); +"</div>" 
  let clipboard = new ClipboardJS('#copyToClipBoard');
  clipboard.on('success', function(e) {
    e.clearSelection();
});

}

function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}

loadItems();